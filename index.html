<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Daily knowledge extract</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Daily knowledge extract">
<meta property="og:url" content="http://blueint32.github.io/index.html">
<meta property="og:site_name" content="Daily knowledge extract">
<meta property="og:locale" content="fr_FR">
<meta property="article:author" content="BlueInt32">
<meta property="article:tag" content="developpement, français, code">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Daily knowledge extract" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Daily knowledge extract</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">À propos</a>
        
          <a class="main-nav-link" href="/contact">Contact</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Rechercher"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blueint32.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CSS-margin-flex-et-only-child" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/27/CSS-margin-flex-et-only-child/" class="article-date">
  <time class="dt-published" datetime="2021-10-27T13:48:17.000Z" itemprop="datePublished">2021-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/27/CSS-margin-flex-et-only-child/">CSS : margin, flex et sélecteur :only-child</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA qu’il existait un lien et des règles spécifiques d’interaction entre <code>display: flex;</code> et <code>margin:auto;</code> en CSS - alors qu’a priori on pourrait penser que ça ne va pas du tout fonctionner ensemble. Et puis JA aussi qu’il existait un selecteur css <code>:only-child</code>, ce qui est pratique mais plus anecdotique.</p>
<p>Donnons-nous un exemple concret pour mettre tout cela en pratique.</p>
<p>Supposons que vous voulions créer un footer de page contenant des boutons “Previous” et “Next”, par exemple pour une appli avec un wizard de création d’objet en plusieurs étapes.<br>Je veux afficher la bouton “Previous” complètement à gauche, et le bouton “Next” complètement à droite, comme ceci : </p>
<p><img src="/2021/10/27/CSS-margin-flex-et-only-child/default.png"></p>
<p>Pour cela, on utilise la structure HTML suivante (simplifiée).</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Previous&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Next&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Et le css suivant pour le footer :</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#255f7e</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Super ! </p>
<p>Sauf qu’un problème se pose pour la première étape, dans laquelle il n’y a pas de bouton “Previous”. </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--     &lt;input type=&quot;button&quot; value=&quot;Previous&quot; /&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Next&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Mon bouton “Next” se retrouve à gauche à cause du comportement par défaut de flex et du <code>justify-content: space-between;</code> :</p>
<p><img src="/2021/10/27/CSS-margin-flex-et-only-child/issue.png"></p>
<p>Pour régler ce problème, on va utiliser la capacité de margin combinée avec flex. </p>
<p>Il faut savoir que l’utilisation d’une règle <code>margin: auto;</code> sur un item se trouvant dans un context “flex” va étendre la marge de cet item pour occuper toute la place disponible dans le conteneur, dans la direction spécifiée.<br>Cela veut dire que si on applique <code>margin-left: auto;</code> sur notre bouton “Next”, une marge de la largeur restante du conteneur va être placée à sa gauche, revenant à le placer sur la droite : </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=button]</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">3px</span> <span class="number">3px</span> <span class="number">0px</span> <span class="number">#255f7e</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#00a8ff</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">margin-left</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/10/27/CSS-margin-flex-et-only-child/fix-1.png"></p>
<p>C’est bien pratique ! Cela permet aussi de centrer des éléments, car si on ne donne pas de direction, la marge va être partagée dans les directions opposables et centrer l’élément naturellement. <a target="_blank" rel="noopener" href="https://css-tricks.com/the-peculiar-magic-of-flexbox-and-auto-margins/">Plus d’infos ici.</a></p>
<p>Mais si on remet notre bouton “Previous”, on obtient un nouveau probleme - les deux boutons partagent l’espace horizontal disponible du conteneur pour leur marge de gauche : </p>
<p><img src="/2021/10/27/CSS-margin-flex-et-only-child/issue-2.png"></p>
<p>Il suffit donc d’appliquer le selecteur CSS <code>:only-child</code> et de n’appliquer la marge que là : </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=button]</span><span class="selector-pseudo">:only-child</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Et voilà !😃</p>
<p><img src="/2021/10/27/CSS-margin-flex-et-only-child/fix-2.png"></p>
<p>Et ne me remerciez pas pour la beauté du design, c’est cadeau !</p>
<p><a target="_blank" rel="noopener" href="https://codepen.io/BlueInt32/pen/ZEJKgXw">Le code-pen pour faire joujou</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/10/27/CSS-margin-flex-et-only-child/" data-id="ckx0bunhd0004n3old3qcelte" data-title="CSS : margin, flex et sélecteur :only-child" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JS-suppression-d-une-propriete" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/21/JS-suppression-d-une-propriete/" class="article-date">
  <time class="dt-published" datetime="2021-10-21T15:11:06.000Z" itemprop="datePublished">2021-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/21/JS-suppression-d-une-propriete/">JS: Syntaxe cryptique pour supprimer une propriété d&#39;un objet</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA qu’il existait une manière assez intriguante de retirer une propriété d’un objet en JS : </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">prop1</span>: <span class="string">&#x27;hey&#x27;</span>, <span class="attr">prop2</span>: <span class="string">&#x27;ho&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">obj = (<span class="function">(<span class="params">&#123; prop2, ...o &#125;</span>) =&gt;</span> o)(obj);</span><br><span class="line"><span class="comment">// équivaut à </span></span><br><span class="line"><span class="keyword">delete</span> obj.prop2;</span><br></pre></td></tr></table></figure>

<p>Si on regarde bien ce “one-liner”, on a une lambda qui pourrait être extraite comme ceci : </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">prop1</span>: <span class="string">&#x27;hey&#x27;</span>, <span class="attr">prop2</span>: <span class="string">&#x27;ho&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">obj = prop2Remover(obj);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prop2Remover</span>(<span class="params">&#123; prop2, ...o &#125;</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>On voit une utilisation plutôt élégante et combinée de l’<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">object destructuring</a> et de la syntaxe <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread</a>, que l’on pourrait encore décortiquer davantage :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">prop1</span>: <span class="string">&#x27;hey&#x27;</span>, <span class="attr">prop2</span>: <span class="string">&#x27;ho&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">obj = prop2Remover(obj);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prop2Remover</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// le pattern matching va chercher la propriété prop2 dans obj </span></span><br><span class="line">	<span class="comment">// et le spread operator va assigner tout le reste de obj à o !</span></span><br><span class="line">	<span class="keyword">const</span> &#123; prop2, ...o &#125; = obj;</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Cette syntaxe peut paraître un peu cuistre par rapport au <code>delete</code>, mais on peut quand même y trouver un intérêt. Par exemple si l’on veut assigner l’objet “nettoyé” en une seule instruction. De plus, l’opérateur spread effectue une nouvelle copie ce qui n’est pas à négliger dans certains contextes par exemple vuex ou redux.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">prop1</span>: <span class="string">&#x27;hey&#x27;</span>, <span class="attr">prop2</span>: <span class="string">&#x27;ho&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// une seule instruction pour &#x27;clean up&#x27; l&#x27;objet obj et l&#x27;assigner dans otherObj</span></span><br><span class="line"><span class="keyword">const</span> otherObj = &#123;</span><br><span class="line">	otherProp1: <span class="string">&#x27;lol&#x27;</span>,</span><br><span class="line">	otherProp2: (<span class="function">(<span class="params">&#123; prop2, ...o &#125;</span>) =&gt;</span> o)(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Mais bon, autrement, c’est vraiment pour frimer ! 😃</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/10/21/JS-suppression-d-une-propriete/" data-id="ckx0bunic001en3ol4ogr39ev" data-title="JS: Syntaxe cryptique pour supprimer une propriété d&#39;un objet" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/" rel="tag">JS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Csharp-Index-dans-foreach" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/27/Csharp-Index-dans-foreach/" class="article-date">
  <time class="dt-published" datetime="2021-09-27T06:57:57.000Z" itemprop="datePublished">2021-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/27/Csharp-Index-dans-foreach/">C#: astuce avec foreach</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA que l’on pouvait obtenir l’index dans une boucle foreach d’une façon assez pratique sans avoir à incrémenter un compteur à la main (ce qui est vulgaire 😏). La fonction Select de Linq possède en effet <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.select?view=net-5.0#System_Linq_Enumerable_Select__2_System_Collections_Generic_IEnumerable___0__System_Func___0_System_Int32___1__">un overload</a> qui prend une lambda prenant en charge l’index de boucle.</p>
<p>Avant C#7:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> item <span class="keyword">in</span> inputList.Select((wheel, i) =&gt; <span class="keyword">new</span> &#123; wheel, i&#125;)) &#123;</span><br><span class="line">	Console.WriteLine(<span class="string">$&quot;Wheel n°<span class="subst">&#123;item.i + <span class="number">1</span>&#125;</span> : <span class="subst">&#123;item.wheel.friction&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mais ce n’est pas super car on se trimballe un <code>item</code> dont on se passerait bien.</p>
<p>Heureusement, depuis C#7 (avec <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/functional/deconstruct">la déconstruction de Tuples</a>), on peut directement assigner les variables :</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>((Wheel wheel, <span class="built_in">int</span> i) <span class="keyword">in</span> inputList.Select((<span class="keyword">value</span>, i) =&gt; (wheel, i))) &#123;</span><br><span class="line">	Console.WriteLine(<span class="string">$&quot;Numero <span class="subst">&#123;i + <span class="number">1</span>&#125;</span> : <span class="subst">&#123;wheel.friction&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Attention cependant, ça peut vite nuire à la lisibilité du code car on est forcé de spécifier les types et l’instruction foreach devient vite indigeste sur une ligne.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/09/27/Csharp-Index-dans-foreach/" data-id="ckx0bunhh0006n3ol0psd64qd" data-title="C#: astuce avec foreach" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-SQL-Window-functions-et-aggregation-functions" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/26/SQL-Window-functions-et-aggregation-functions/" class="article-date">
  <time class="dt-published" datetime="2021-07-26T10:11:20.000Z" itemprop="datePublished">2021-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/26/SQL-Window-functions-et-aggregation-functions/">SQL - Window functions et aggregation functions</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA que je n’avais rien écouté pendant le cours sur les bases de données 🤨 : je n’avais jamais entendu parler des “window functions”, qui sont un peu les cousines des aggregation functions. EN SQL il est courant d’utiliser des aggregation functions par exemple pour compter les lignes d’une table avec la méthode <code>COUNT()</code>.</p>
<p>Les window function permettent de faire à peu près la même chose, sauf qu’elles agissent a posteriori et peuvent permettre d’éviter de tomber dans l’utilisation de requêtes imbriquées qui sont plutôt moins performantes.</p>
<p>Dans ce billet, pour introduire la notion de window function, je vais présenter un problème que j’ai rencontré dans un projet perso. Je vais tout d’abord décrire le jeu de données utilisé, mon approche initiale et l’approche <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/68525988/how-to-avoid-using-a-subquery-for-exclusion-in-a-many-to-many-sql-model">qui m’a été soufflée par un chic type sur stackoverflow</a>. Malgré toute la justesse de sa réponse, elle était quand même plutôt expédiée (note : insérer ici un commentaire sur la course à la réputation dans le site stackoverflow) ; cela m’a amené à mener ma petit enquête et ce billet est né.</p>
<h2 id="Le-contexte"><a href="#Le-contexte" class="headerlink" title="Le contexte"></a>Le contexte</h2><p>Notre blog de vidéos rigolotes nécéssite trois tables SQL afin de représenter le fait que les <code>posts</code> créés sont associés à des <code>tags</code>. </p>
<p><img src="/2021/07/26/SQL-Window-functions-et-aggregation-functions/diagram.png"></p>
<p>Par exemple, pour créer un billet de blog “Chicken flying over a cucumber”, je vais créer une entrée dans la table <code>posts</code>, trois entrées dans la table <code>tags</code> (“chicken”, “funny”, “cucumber”) et trois entrées dans une table d’association <code>poststags</code> connectant le tout. </p>
<p> ℹ️ Une table d’association est ici nécéssaire pour représenter une relation de type “many-to-many” entre <code>posts</code> et <code>tags</code> car un post peut avoir plusieurs tags et un tag peut décorer plusieurs posts.</p>
<p>Pendant plusieurs mois, je remplis mon blog de supers vidéos, tout va bien même si mes choix éditoriaux ne m’amènent que peu de visites mais ce n’est pas le sujet de cet article.</p>
<p>Plus tard dans le développement de mon blog, je voudrais faire des statistiques, par exemple “Quel est le nombre d’articles de blog ne comportant aucun chat et n’étant pas drôle non plus ? “, autrement dit, il s’agit de compter le nombre de <code>posts</code> n’ayant aucune association avec les <code>tags</code> “cat” et “funny”.</p>
<p><strong>Mon objectif est donc de pouvoir compter le nombre de posts ne contenant pas certains tags.</strong></p>
<h2 id="Les-donnees"><a href="#Les-donnees" class="headerlink" title="Les données"></a>Les données</h2><p><strong>Posts</strong></p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Title</th>
<th>Content</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Chicken flying over a cucumber</td>
<td>…</td>
</tr>
<tr>
<td>2</td>
<td>Cat eating a cucumber</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>Cucumber wants to take revenge</td>
<td>…</td>
</tr>
<tr>
<td>4</td>
<td>Snail sad because no cucumber left</td>
<td>…</td>
</tr>
</tbody></table>
<p><strong>Tags</strong></p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Label</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>cat</td>
</tr>
<tr>
<td>2</td>
<td>funny</td>
</tr>
<tr>
<td>3</td>
<td>snail</td>
</tr>
<tr>
<td>4</td>
<td>cucumber</td>
</tr>
<tr>
<td>5</td>
<td>chicken</td>
</tr>
</tbody></table>
<p><strong>PostsTags</strong></p>
<table>
<thead>
<tr>
<th>Id</th>
<th>PostId</th>
<th>TagId</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>7</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>8</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>9</td>
<td>4</td>
<td>3</td>
</tr>
</tbody></table>
<p>On voit par exemple que “Cat eating a cucumber” est une vidéo avec les tags “cat”, “cucumber” et “funny” (oui, c’est rigolo).</p>
<h3 id="Resolution-du-probleme-avec-l’approche-“SQL-newbie”-requete-imbriquee"><a href="#Resolution-du-probleme-avec-l’approche-“SQL-newbie”-requete-imbriquee" class="headerlink" title="Résolution du problème avec l’approche “SQL newbie” (requête imbriquée)"></a>Résolution du problème avec l’approche “SQL newbie” (requête imbriquée)</h3><p>Je rappelle mon problème : je cherche à compter le nombre de posts n’ayant ni le tag “cat” ni le tag “funny”.</p>
<p>La première considération, c’est que l’ensemble de l’information nécéssaire pour répondre à cette question est contenue dans la table PostsTags. Je n’ai pas besoin de considérer les autres tables pour répondre.</p>
<p>Première étape, isoler les posts contenant soit un tag “cat” soit un tag “funny” (il s’agit bien d’un OR ici, car je veux à terme la négation de ce jeu de données, qui sera un NAND entre tous les tags à exclure). Pour cela on utilise l’opérateur <code>in</code>.</p>
<p>Voici la requête : </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> postid </span><br><span class="line"><span class="keyword">from</span> poststags </span><br><span class="line"><span class="keyword">where</span> TagId <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> postid</span><br></pre></td></tr></table></figure>

<p>Ce qui donne : </p>
<table>
<thead>
<tr>
<th>Id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>3</td>
</tr>
</tbody></table>
<p>En effet, tous les posts parlent de chat ou sont drôles, sauf le post 4.</p>
<p>Ensuite, c’est tout simple en utilisant <code>not in</code> (c’est à dire une requête imbriquée), je n’ai plus qu’à compter l’ensemble des posts ne se trouvant pas dans ce premier résultat : </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(p.Id)</span><br><span class="line"><span class="keyword">from</span> posts p</span><br><span class="line"><span class="keyword">where</span> p.Id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">	<span class="keyword">select</span> postid </span><br><span class="line">	<span class="keyword">from</span> poststags </span><br><span class="line">	<span class="keyword">where</span> TagId <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	<span class="keyword">group</span> <span class="keyword">by</span> postid)</span><br></pre></td></tr></table></figure>

<p>Ça fonctionne, mais quand la requête imbriquée a beaucoup de résultats, la performance peut en prendre un coup.</p>
<h3 id="Resolution-du-probleme-avec-l’approche-“SQL-professional”-“aggregation-function”-et-“window-function”"><a href="#Resolution-du-probleme-avec-l’approche-“SQL-professional”-“aggregation-function”-et-“window-function”" class="headerlink" title="Résolution du problème avec l’approche “SQL professional” (“aggregation function” et “window function”)"></a>Résolution du problème avec l’approche “SQL professional” (“aggregation function” et “window function”)</h3><p>De la même manière, je vais procéder par étapes simples. </p>
<ol>
<li>Tout d’abord, on va chercher à obtenir pour chaque association dans <code>posttags</code> si le tag est “cat” ou “funny”. Pour cela on va encore utiliser l’opérateur <code>in</code>, mais cette fois-ci dans la clause select. L’idée est de préparer le terrain pour faire une somme des booléens obtenus.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> postId, TagId <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">as</span> tagIsCatOrFunny</span><br><span class="line"><span class="keyword">from</span> poststags</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PostId</th>
<th>tagIsCatOrFunny</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
</tr>
</tbody></table>
<ol start="2">
<li>On voit que chaque résultat précédent représente une association post-tag et qu’il va falloir grouper par postid pour aggréger intelligemment la valeur <code>tagIsCatOrFunny</code> : on va utiliser <code>group by</code> et la fonction d’aggrégation <code>SUM</code> pour obtenir pour chaque postid la somme du nombre de fois que le tag “chat” ou “funny” est représenté pour un post. Il est à noter ici que <code>SUM</code> pourrait être utilisé sans le <code>group by</code> mais cela nous retournerait une ligne unique avec le nombre total d’occurence d’associations dont le tag est “cat” ou “funny”, ce qui ne nous intéresse pas.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> postid, <span class="built_in">SUM</span>(tagid <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>)) <span class="keyword">as</span> occurencesOfCatOrFunny</span><br><span class="line"><span class="keyword">from</span> poststags</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> postid</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>PostId</th>
<th>tagIsCatOrFunny</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
</tr>
</tbody></table>
<p>On constate bien que par exemple, le post 2 “Cat eating a cucumber” est bien à la fois “funny” et contenant un chat.</p>
<ol start="3">
<li>On sait qu’à terme, on veut le nombre de fois que cette table contient la valeur 0 pour <code>tagIsCatOrFunny</code>, ajoutons donc simplement <code>= 0</code> à notre colonne de somme : </li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> postid, <span class="built_in">SUM</span>(tagid <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>)) <span class="operator">=</span> <span class="number">0</span> <span class="keyword">as</span> hasNoOccurencesOfCatOrFunny</span><br><span class="line"><span class="keyword">from</span> poststags</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> postid</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>PostId</th>
<th>tagIsCatOrFunny</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
</tr>
</tbody></table>
<ol start="4">
<li>Il ne “reste plus qu’à” faire la somme de l’ensemble des valeurs de cette colonne pour obtenir le nombre final. Ça se complique un peu car il n’est pas permis d’aggréger directement le résultat d’une aggrégation en SQL (c’est pour cela qu’on voit très souvent des fonctions imbriquées pour traiter ce genre de situation). Or les window functions peuvent venir à la rescousse, car elles sont calculées de façon indépendante et après la ou les fonctions d’aggrégation. Le marqueur d’une window function est l’utilisation du mot clef <code>OVER</code> : </li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> postId, <span class="built_in">SUM</span>(<span class="built_in">SUM</span>(tagid <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>)) <span class="operator">=</span> <span class="number">0</span>) <span class="keyword">OVER</span>()</span><br><span class="line"><span class="keyword">from</span> poststags</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> postid</span><br></pre></td></tr></table></figure>
<p>Sans rentrer trop dans les détails (voir les liens en fin d’article pour plus d’info), il faut savoir que les window functions sont assez proches des fonctions d’aggrégation, mais une grande différence est qu’elles maintiennent les lignes sur lesquelles elles agissent (les fonctions d’aggrégation vont au contraire combiner les lignes pour chaque groupe). Par ailleurs, la définition de la “window frame” dans le <code>OVER()</code> détermine sur quel set de lignes le fonction s’applique, en l’occurence toutes les lignes ici, car la clause <code>OVER()</code> est vide.</p>
<p>On obtient le résultat suivant :</p>
<table>
<thead>
<tr>
<th>PostId</th>
<th>targetValue</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
</tr>
</tbody></table>
<p>Pour chaque ligne de la table intermédiaire précédente, on a calculé “la somme des sommes”. Et comme la window function maintient les lignes de la table sur laquelle elle est appliquée, on obtient le résultat autant de fois qu’il y a de posts. </p>
<ol start="5">
<li>Sachant que chaque ligne aura la même valeur de somme, on peut simplement ajouter <code>distinct</code> pour récupérer une ligne unique (on en profite pour retirer le postId qui n’aura plus de sens) : </li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="built_in">SUM</span>(<span class="built_in">SUM</span>(tagid <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>)) <span class="operator">=</span> <span class="number">0</span>)  <span class="keyword">OVER</span>() <span class="keyword">as</span> finalResult</span><br><span class="line"><span class="keyword">from</span> poststags</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> postid</span><br></pre></td></tr></table></figure>

<p>Et voilà, on obtient notre résultat sans utiliser de requête imbriquée !</p>
<table>
<thead>
<tr>
<th>targetValue</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<p>Il ne me reste plus qu’à mesurer à quel point cette technique est plus performante que l’utilisation de requête imbriquées mais cet article est déjà long !</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://learnsql.com/blog/window-functions-vs-aggregate-functions/">Voici une page</a> expliquant très clairement la différence entre les aggregation functions et les window functions </p>
<p>Enfin, <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=QnnqEnbYBDk">une vidéo de chat mangeant un concombre</a> </p>
<style>
table {
    max-width: 40%;
}
</style>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/07/26/SQL-Window-functions-et-aggregation-functions/" data-id="ckx0bunhv000nn3ol3vt3bjvz" data-title="SQL - Window functions et aggregation functions" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql/" rel="tag">sql</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Csharp-la-base-de-l-asynchrone" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/14/Csharp-la-base-de-l-asynchrone/" class="article-date">
  <time class="dt-published" datetime="2021-06-14T05:01:14.000Z" itemprop="datePublished">2021-06-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/14/Csharp-la-base-de-l-asynchrone/">C# : la base de l&#39;asynchrone</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA un peu plus précisément comment fonctionnait le système de gestion des tâches asynchrones en C#. J’ai découvert <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">une page de documentation microsoft</a> vraiment bien écrite pour découvrir (ou redécouvrir) le sujet en détail. </p>
<p>L’article est fondé sur l’analogie de la préparation d’un petit déjeuner : certaines des tâches ne nécessitent pas la présence constante d’un cuistot, par exemple pendant que les tartines cuisent dans le grille-pain. On comprend intuitivement que personne de sain d’esprit ne resterait planté devant le grille-pain alors qu’il est possible de cuire les oeufs et de verser le jus d’orange en attendant. On parle de tâche asynchrone.</p>
<p>En .net, ce concept de tâche asynchrone est implémenté à l’aide de l’objet <code>Task</code>. Il représente non pas l’action de faire quelque chose (comme le ferait une fonction quelconque) mais plutôt le fait qu’une action est en cours, il s’agit donc d’une représentation de son status. Cela correspond pratiquement à la notion de promesse en JS.</p>
<p>Concrètement, il peut s’agir d’un appel à un service externe. Voici un exemple particulièrement utile : </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;ImportantData&gt; <span class="title">GetDataAsync</span>(<span class="params"><span class="built_in">int</span> taskNumber</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">await</span> Task.Run(() =&gt;</span><br><span class="line">	&#123;</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;\tLong task start &quot;</span> + taskNumber);</span><br><span class="line">		Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;\tTick &quot;</span> + taskNumber);</span><br><span class="line">		Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;\tTick &quot;</span> + taskNumber);</span><br><span class="line">		Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;\tLong task finish &quot;</span> + taskNumber);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ImportantData();</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Un utilisateur de cette méthode asynchrone pourra adopter plusieurs stratégies, plus ou moins efficaces. </p>
<p>Tout d’abord il est possible d’appeler cette méthode sans syntaxe particulière comme ceci : </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program start&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> gettingImportantData1 = SlowService.GetDataAsync(<span class="number">1</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Synchronous task&quot;</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program end&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ici, l’éxecution ne va pas se bloquer pour attendre <code>GetDataAsync</code>. Cela veut dire que le programme va se terminer avant même que la tâche ait effectué son premier “tick” : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Program start</span><br><span class="line">        Long task start 1</span><br><span class="line">Synchronous task</span><br><span class="line">Program end</span><br></pre></td></tr></table></figure>

<p>Autre possibilité : attendre.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program start&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> gettingImportantData1 = <span class="keyword">await</span> SlowService.GetDataAsync(<span class="number">1</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Synchronous task&quot;</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program end&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dans ce cas, le programme va suspendre son execution et attendre la fin de la tâche longue avant de reprendre : on note cependant que la tâche synchrône est toujours effectuée après la tâche longue.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Program start</span><br><span class="line">        Long task start 1</span><br><span class="line">        Tick 1</span><br><span class="line">        Tick 1</span><br><span class="line">        Long task finish 1</span><br><span class="line">Synchronous task</span><br><span class="line">Program end</span><br></pre></td></tr></table></figure>

<p>⚠️ Ici, il est important de noter que pendant l’exécution de la tâche longue (avec <code>await</code>), la CLR relâche le thread. Dans un contexte web ou client WPF par exemple, cela signifie que d’autres actions utilisateurs pourront être prises en charge par ce thread en attendant. Ce n’est pas du tout négligeable pour la scalabilité.</p>
<p>Toujours est-il que notre programme en tant que tel n’est pas très optimisé : en effet, je préfèrerais largement gagner du temps sur l’éxecution de ma tâche synchrone et l’effectuer en parallèle de la tâche longue. Et qui sait, peut-être voudrais-je appeler deux fois ma tâche longue avec d’autres paramètres !</p>
<p>C’est très simple, il suffit d’ordonnancer les appels de façon intuitive par rapport aux tâches : </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program start&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> gettingImportantData1 = SlowService.GetDataAsync(<span class="number">1</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Synchronous task&quot;</span>);</span><br><span class="line">	<span class="keyword">await</span> gettingImportantData1;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program end&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>On voit ici qu’il y a une différence entre démarrer une tâche asynchrône, et forcer l’attente de la fin de son exécution. L’objet <code>Task</code> permet de garder la main sur cela et d’avoir enfin un programme performant :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Program start</span><br><span class="line">        Long task start 1</span><br><span class="line">Synchronous task</span><br><span class="line">        Tick 1</span><br><span class="line">        Tick 1</span><br><span class="line">        Long task finish 1</span><br><span class="line">Program end</span><br></pre></td></tr></table></figure>

<p>Et comme je l’avais envisagé, je peux appeler ma tâche longue plusieurs fois en parallèle : </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program start&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> gettingImportantData1 = SlowService.GetDataAsync(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">var</span> gettingImportantData2 = SlowService.GetDataAsync(<span class="number">2</span>);</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Synchronous task&quot;</span>);</span><br><span class="line">	<span class="keyword">await</span> gettingImportantData1;</span><br><span class="line">	<span class="keyword">await</span> gettingImportantData2;</span><br><span class="line">	Console.WriteLine(<span class="string">&quot;Program end&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Et ainsi obtenir le parallelisme attendu :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Program start</span><br><span class="line">Synchronous task</span><br><span class="line">        Long task start 1</span><br><span class="line">        Long task start 2</span><br><span class="line">        Tick 1</span><br><span class="line">        Tick 2</span><br><span class="line">        Tick 1</span><br><span class="line">        Tick 2</span><br><span class="line">        Long task finish 1</span><br><span class="line">        Long task finish 2</span><br><span class="line">Program end</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/06/14/Csharp-la-base-de-l-asynchrone/" data-id="ckx0bunhi0007n3olg71w7kyv" data-title="C# : la base de l&#39;asynchrone" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-html-js-astuce-pour-telecharger-un-fichier-depuis-le-browser" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/01/html-js-astuce-pour-telecharger-un-fichier-depuis-le-browser/" class="article-date">
  <time class="dt-published" datetime="2021-06-01T06:58:08.000Z" itemprop="datePublished">2021-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/01/html-js-astuce-pour-telecharger-un-fichier-depuis-le-browser/">HTML/JS : astuce pour générer un fichier téléchargeable depuis le browser</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA que les hyperliens HTML pouvaient spécifier un attribut <code>download</code> permettant de forcer le téléchargement d’un fichier depuis un lien donné.</p>
<p>Certes, les navigateurs ont tendance à outrepasser ce comportement pour beaucoup de types de fichiers par défaut (ils vont par exemple afficher directement une image même si le lien a cet attribut).</p>
<p>Cependant, il est possible d’utiliser cette technique pour générer un téléchargement en créant un hyperlien à la volée (“sur la mouche”, comme on dit dans le milieu).</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;clickHandler()&quot;</span>&gt;</span>Clique moi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">clickHandler</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> data =</span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;More than cleverness, we need kindness and gentleness. Charlie Chaplin&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> fileURL = <span class="built_in">window</span>.URL.createObjectURL(<span class="keyword">new</span> Blob([data]));</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> fileLink = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"></span><br><span class="line">      fileLink.href = fileURL;</span><br><span class="line"><span class="javascript">      fileLink.setAttribute(<span class="string">&quot;download&quot;</span>, <span class="string">&quot;charlie.txt&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.body.appendChild(fileLink);</span></span><br><span class="line">      fileLink.click();</span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.body.removeChild(fileLink);</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Si par exemple des données JSON sont retournées par une API, il est ainsi parfaitement possible de créer un fichier pour le rendre téléchargeable à partir de la chaîne de caractères.</p>
<p>Par ailleurs, on voit que la fonction utilise un <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a> dont les mystères restent encore à découvrir 🙂.</p>
<p>En tout cas, c’est malin !</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/06/01/html-js-astuce-pour-telecharger-un-fichier-depuis-le-browser/" data-id="ckx0buni2000yn3ol4kxw7573" data-title="HTML/JS : astuce pour générer un fichier téléchargeable depuis le browser" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JS-une-syntaxe-marrante-pour-filtrer" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/15/JS-une-syntaxe-marrante-pour-filtrer/" class="article-date">
  <time class="dt-published" datetime="2021-05-15T15:01:58.000Z" itemprop="datePublished">2021-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/15/JS-une-syntaxe-marrante-pour-filtrer/">JS : une syntaxe marrante pour filtrer</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA une syntaxe intéressante pour filtrer facilement un tableau en fonction de la “truthiness” de ses valeurs.</p>
<p>Imaginons le tableau suivant :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = [<span class="string">&quot;mon&quot;</span>, <span class="literal">NaN</span>, <span class="string">&quot;beau&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;tableau&quot;</span>, <span class="string">&quot;&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>Pour filtrer ce tableau, j’aurais utilisé le code suivant :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cleanArray = myArray.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i);</span><br></pre></td></tr></table></figure>

<p>Car <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a> évalue la truthiness de la lambda pour chaque élément, cela fonctionne.</p>
<p>Or <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/19903063/1199535">sur stackoverflow</a>, j’ai lu la réponse suivante :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cleanArray = myArray.filter(<span class="built_in">Boolean</span>);</span><br></pre></td></tr></table></figure>

<p>Comment ça ? 🤔 J’ai tout d’abord cru qu’il s’agissait d’une syntaxe bizarre que je ne connaissais pas.</p>
<p>Mais en fait, en JS, <code>Boolean</code> n’est pas seulement un type, c’est également un constructeur, ou encore une fonction. Et il se trouve que l’on peut construire un booléen en lui fournissant n’importe quoi en entrée, ce qui donnera à ce booléen la truthiness de la valeur fournie.</p>
<p>En somme, les trois syntaxes suivantes sont équivalentes :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cleanArray1 = myArray.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i);</span><br><span class="line"><span class="keyword">const</span> cleanArray2 = myArray.filter(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">Boolean</span>(i));</span><br><span class="line"><span class="keyword">const</span> cleanArray3 = myArray.filter(<span class="built_in">Boolean</span>);</span><br></pre></td></tr></table></figure>

<p>Après… Entre nous, à part pour briller en société, la syntaxe ne me parait pas beaucoup plus lisible, mais c’était marrant de découvrir cette manière de procéder.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/05/15/JS-une-syntaxe-marrante-pour-filtrer/" data-id="ckx0bunib001dn3olf4oz49tr" data-title="JS : une syntaxe marrante pour filtrer" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/" rel="tag">JS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CSS-comprendre-les-ellipses-de-texte" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/" class="article-date">
  <time class="dt-published" datetime="2021-05-15T07:04:22.000Z" itemprop="datePublished">2021-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/">CSS : comprendre les ellipses de texte</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA comment fonctionnaient vraiment les ellipses de texte en CSS. A priori, on pourrait croire qu’il suffirait d’une ligne de CSS pour les mettre en place. En réalité, c’est un tout petit peu plus compliqué que ça.</p>
<p>En effet, il s’agit de spécifier au navigateur la chose suivante : “si ce texte est trop long, il ne doit pas dépasser de son conteneur et afficher trois petits points juste avant de dépasser”.</p>
<p>Tout d’abord, voyons comment le texte se comporte lorsqu’aucune règle particulière n’est appliquée :</p>
<p><img src="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/example-1.png"></p>
<p>On constate que, par défaut, le moteur CSS applique un “wrapping”, qui donne au texte la propriété d’aller automatiquement à la ligne lorsqu’il rencontre les bords du conteneur.</p>
<p>Or, notre objectif est que le texte n’aille pas à la ligne mais qu’il soit caché. Il faut donc tout d’abord désactiver ce “wrapping” :</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/example-2.png"></p>
<p>Ensuite, il semble clair que tout ce qui dépasse doit être rabotté ! Cela n’est manifestement pas le cas par défaut, il y a donc une nouvelle règle CSS à ajouter à notre code :</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/example-3.png"></p>
<p>Apparement, le moteur CSS ne veut pas appliquer l’ellipse par défaut. En effet, son comportement par défaut est “clip”, ce qui signifie que le texte sera coupé sans autre forme de procès. C’est peu élégant. Appliquons notre ellipse ici :</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line"><span class="attribute">text-overflow</span>: ellipsis;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/15/CSS-comprendre-les-ellipses-de-texte/example-4.png"></p>
<p>Et voilà ! 😅</p>
<p>Ce qu’il faut retenir de tout ça, c’est que cette dernière règle seule ne se “met en route” que dans le contexte où le texte va sortir de son conteneur (<code>white-space: nowrap;</code>) et où ce dépassement est caché (<code>overflow: hidden</code>).</p>
<p>Le code des exemples se trouve dans ce <a target="_blank" rel="noopener" href="https://codepen.io/BlueInt32/pen/GRWZVaR">codepen</a>.</p>
<p>Sinon, vous trouverez plus de détail sur <code>text-overflow</code> dans l’excellente documentation <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/text-overflow">MDN Web Docs</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/05/15/CSS-comprendre-les-ellipses-de-texte/" data-id="ckx0bunhb0003n3ol88eefkop" data-title="CSS : comprendre les ellipses de texte" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/" rel="tag">html</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Vim-plus-de-flexibilite-avec-vim-surround" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/15/Vim-plus-de-flexibilite-avec-vim-surround/" class="article-date">
  <time class="dt-published" datetime="2021-05-15T06:19:31.000Z" itemprop="datePublished">2021-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/15/Vim-plus-de-flexibilite-avec-vim-surround/">Vim : plus de flexibilité avec vim-surround</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA que le plugin Vim de VsCode proposait d’activer <a target="_blank" rel="noopener" href="https://github.com/VSCodeVim/Vim#vim-surround">vim-surround</a>, qui est à l’origine un <a target="_blank" rel="noopener" href="https://github.com/tpope/vim-surround">plugin de Vim</a> particulièrement pratique. Il fait économiser beaucoup de manipulations.</p>
<p>Voici un exemple de texte :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Texte à manipuler avec vim.</span><br></pre></td></tr></table></figure>

<p>Sans vim-surround, si on veut mettre les mot <code>manipuler avec vim</code> entre guillemets, en supposant que le curseur se trouve au début de la ligne, la manipulation est la suivante :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wwi&quot;&lt;esc&gt;3ea&quot;</span><br></pre></td></tr></table></figure>

<p>Avec vim-surround, cela devient plus idiomatique :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wwys3w&quot;</span><br></pre></td></tr></table></figure>

<p>Le principe est de n’écrire qu’une fois le caractère englobant, et de dire à vim-surround comment atteindre la fin de l’expression à entourer avec un déplacement (ici <code>3w</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ys3w&quot;</span><br></pre></td></tr></table></figure>

<p>pourrait être traduit en :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You Surround 3 Words with &quot;</span><br></pre></td></tr></table></figure>

<p>C’est déjà une belle économie. Mais je n’aime personnellement pas beaucoup compter les mots pour les mouvements car ce n’est pas très fiable dans du code source. J’utilise plutôt des sélections en mode visuel (potentiellement en utilisant la souris).</p>
<p>Heureusement, vim-surround permet d’être actionné à partir d’une sélection avec <code>S</code> (s majuscule) !</p>
<p>vim-surround fait selon moi vraiment la différence pour remplacer des caractères déjà existant.</p>
<p>Reprenons notre texte modifié :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Texte à &quot;manipuler avec vim&quot;.</span><br></pre></td></tr></table></figure>

<p>Si je veux remplacer les guillemets par des parenthèses, la manipulation sans vim-surround est encore une fois fastidieuse :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wwr(eeelr)</span><br></pre></td></tr></table></figure>

<p>Avec vim-surround :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wwcs&quot;)</span><br></pre></td></tr></table></figure>

<p>où <code>cs&quot;)</code> pourrait être traduit en</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Change Surround &quot; to )</span><br></pre></td></tr></table></figure>

<p>On obtient alors directement</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Texte à (manipuler avec vim).</span><br></pre></td></tr></table></figure>

<p>Plutôt pratique !</p>
<p>Le petit bonus sympa, c’est qu’en utilisant les caractères ouvrant <code>(</code> ou <code>[</code> dans l’expression de remplacement, vim-surround va automatiquement insérer des espaces à l’intérieur. Ainsi la commande suivante :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wwcs&quot;(</span><br></pre></td></tr></table></figure>

<p>produira le texte suivant :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Texte à ( manipuler avec vim ).</span><br></pre></td></tr></table></figure>

<p>Vim, c’est la vie.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/05/15/Vim-plus-de-flexibilite-avec-vim-surround/" data-id="ckx0buni0000tn3ol3tnrezse" data-title="Vim : plus de flexibilité avec vim-surround" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Le-flag-intent-to-add-dans-git-add" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/12/Le-flag-intent-to-add-dans-git-add/" class="article-date">
  <time class="dt-published" datetime="2021-05-12T06:56:51.000Z" itemprop="datePublished">2021-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/12/Le-flag-intent-to-add-dans-git-add/">git add -N : marquer des fichiers pour ajout</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AJA que l’on pouvait spécifier à git qu’on <em>prévoyait d’ajouter</em> des fichiers sans forcément les ajouter tout de suite à l’index !</p>
<p>Mais pourquoi voudrait-on faire ça ? Eh bien il peut être embêtant dans git de faire des différentiels lorsque certains fichiers viennent d’être rajoutés, car ceux-ci seront tout simplement ignorés par git tant qu’il n’aura pas été mis au courant que ces fichiers ont un rôle dans la base de code (pour autant que git sache, on pourrait très bien vouloir ajouter ces fichiers dans le <code>.gitignore</code>).</p>
<p>Jusqu’ici, je détournais ce comportement en ajoutant tous les fichiers avec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br></pre></td></tr></table></figure>

<p>Ainsi, les nouveaux fichiers apparaissaient dans le diff-tool en utilisant le flag <code>--staged</code> :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff-tool --staged</span><br></pre></td></tr></table></figure>

<p>Et je pouvais noter les fichiers que je voulais réellement inclure dans mon commit, avant de faire <code>git reset</code>… Bref, pas idéal. L’ennui avec cette approche, c’est que l’opération naturelle qui consiste à ajouter certains fichiers au fur à mesure de l’analyse du différentiel n’est plus possible car tous les fichiers sont déjà dans l’index…</p>
<p>Mais ça, c’était avant. Il est possible de spécifier à git que des fichiers vont être ajoutés, sans les ajouter concrètement tout de suite à l’index :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add --intent-to-add .</span><br><span class="line"> ou</span><br><span class="line">$ git add -N .</span><br></pre></td></tr></table></figure>

<p>Les nouveaux fichiers ont alors bien une entrée dans l’index, sans contenu effectif : le diff-tool les verra sans qu’ils soient encore concrètement dans l’index. C’est du temps de gagné ! <img src="/2021/05/12/Le-flag-intent-to-add-dans-git-add/joy.png"></p>
<p>Pour plus d’info sur les options de <code>git add</code>dans la doc officielle <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-add">ici</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blueint32.github.io/2021/05/12/Le-flag-intent-to-add-dans-git-add/" data-id="ckx0bunhu000ln3ol55bk1zrz" data-title="git add -N : marquer des fichiers pour ajout" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Suivant &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/" rel="tag">vuejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-components/" rel="tag">web components</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">octobre 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">septembre 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">juillet 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">juin 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">mai 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/27/CSS-margin-flex-et-only-child/">CSS : margin, flex et sélecteur :only-child</a>
          </li>
        
          <li>
            <a href="/2021/10/21/JS-suppression-d-une-propriete/">JS: Syntaxe cryptique pour supprimer une propriété d&#39;un objet</a>
          </li>
        
          <li>
            <a href="/2021/09/27/Csharp-Index-dans-foreach/">C#: astuce avec foreach</a>
          </li>
        
          <li>
            <a href="/2021/07/26/SQL-Window-functions-et-aggregation-functions/">SQL - Window functions et aggregation functions</a>
          </li>
        
          <li>
            <a href="/2021/06/14/Csharp-la-base-de-l-asynchrone/">C# : la base de l&#39;asynchrone</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 BlueInt32<br>
      Propulsé par <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">À propos</a>
  
    <a href="/contact" class="mobile-nav-link">Contact</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>